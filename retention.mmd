flowchart TD
    A[Object Upload] --> B{Check Retention Policy}
    B -->|No Policy| C[Apply Default Policy]
    B -->|Policy Exists| D{Check Legal Hold}
    
    D -->|Legal Hold Active| E[Protect Object]
    D -->|No Legal Hold| F{Check Object Age}
    
    F -->|Age < Retention Period| G[Keep Object]
    F -->|Age >= Retention Period| H{Check Object Type}
    
    H -->|Critical Data| I[Extend Retention]
    H -->|Regular Data| J{Check Usage}
    
    J -->|Recently Accessed| K[Extend Retention]
    J -->|Not Accessed| L{Check Compliance}
    
    L -->|Compliance Required| M[Extend Retention]
    L -->|No Compliance| N[Mark for Deletion]
    
    E --> O[Log Protection Action]
    G --> P[Log Keep Action]
    I --> Q[Log Extension Action]
    K --> R[Log Extension Action]
    M --> S[Log Extension Action]
    N --> T[Log Deletion Action]
    
    O --> U[Update Object Status]
    P --> U
    Q --> U
    R --> U
    S --> U
    T --> U
    
    U --> V[Schedule Cleanup Job]
    V --> W[Execute Deletion]
    W --> X[Update Audit Log]
    
    %% Legal Hold Override
    E --> Y{Legal Hold Expires?}
    Y -->|Yes| Z[Re-evaluate Retention]
    Y -->|No| AA[Continue Protection]
    
    Z --> F
    AA --> BB[Monitor Legal Hold]
    
    %% Compliance Override
    M --> CC{Compliance Period Ends?}
    CC -->|Yes| DD[Re-evaluate Retention]
    CC -->|No| EE[Continue Protection]
    
    DD --> F
    EE --> FF[Monitor Compliance]
    
    %% Styling
    classDef decision fill:#e1f5fe
    classDef action fill:#f3e5f5
    classDef protect fill:#e8f5e8
    classDef delete fill:#ffebee
    classDef monitor fill:#fff3e0
    
    class B,D,F,H,J,L,Y,CC decision
    class O,P,Q,R,S,T,U,V,W,X action
    class E,I,K,M,AA,EE protect
    class N,W delete
    class BB,FF monitor

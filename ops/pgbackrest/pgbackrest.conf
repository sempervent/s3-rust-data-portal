# BlackLake PgBackRest Configuration
# Week 5: Production backup and disaster recovery

[global]
# Repository configuration
repo1-path=/var/lib/pgbackrest
repo1-retention-full=7
repo1-retention-diff=2
repo1-retention-incr=2

# Backup configuration
backup-standby=y
backup-standby-only=y
backup-standby-no-wal=y

# Compression and encryption
compress-type=lz4
compress-level=6
cipher-type=aes-256-cbc
cipher-pass=file:/etc/pgbackrest/encryption.key

# Performance settings
process-max=4
buffer-size=8388608
checkpoint-fast=y
delta=y

# Logging
log-level-console=info
log-level-file=debug
log-level-stderr=warn
log-path=/var/log/pgbackrest
log-subprocess=y

# Retention policies
repo1-retention-full-type=time
repo1-retention-diff-type=time
repo1-retention-incr-type=time

# WAL archiving
archive-async=y
archive-check=y
archive-copy=y
archive-push-queue-max=1GB

# Spool settings
spool-path=/var/spool/pgbackrest
spool-output=y

# Repository settings
repo1-s3-bucket=blacklake-backups
repo1-s3-endpoint=s3.amazonaws.com
repo1-s3-region=us-east-1
repo1-s3-key=file:/etc/pgbackrest/s3.key
repo1-s3-key-secret=file:/etc/pgbackrest/s3.secret
repo1-s3-uri-style=path

[blacklake]
# Database configuration
pg1-path=/var/lib/postgresql/data
pg1-port=5432
pg1-user=postgres
pg1-host=localhost

# Backup settings
backup-standby=y
backup-standby-only=y
backup-standby-no-wal=y

# Retention for this database
repo1-retention-full=30
repo1-retention-diff=7
repo1-retention-incr=3

# WAL settings
archive-async=y
archive-check=y
archive-copy=y

# Performance tuning
process-max=4
buffer-size=16777216
checkpoint-fast=y
delta=y

# Compression
compress-type=lz4
compress-level=6

# Encryption
cipher-type=aes-256-cbc
cipher-pass=file:/etc/pgbackrest/encryption.key